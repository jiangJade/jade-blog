(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{552:function(s,n,a){"use strict";a.r(n);var e=a(4),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",[s._v("手写深拷贝前先思考几个问题")])]),s._v(" "),a("p",[s._v("1.首先为什么要深拷贝？不希望数据被修改或者只需要部分修改数据。\n2.怎么实现深拷贝？简单需求用 JSON 反序列化，复杂需求用递归克隆。\n3.手写深拷贝的优点？体现扎实的 JS 基础\n4.至于缺点以及如何解决缺点稍后再回答")]),s._v(" "),a("h2",{attrs:{id:"_1-最简单的手写深拷贝就一行，通过-json-反序列化来实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-最简单的手写深拷贝就一行，通过-json-反序列化来实现"}},[s._v("#")]),s._v(" 1 最简单的手写深拷贝就一行，通过 JSON 反序列化来实现")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    const data = JSON.parse(JSON.stringify(res));\n    缺点是JSON value 不支持的数据类型，都拷贝不了\n    不支持函数\n    不支持undefined(支持null)\n    不支持循环引用，比如\n    const obj = {\n        name: '小明'\n    };\n    obj.year = obj;\n    obj = JSON.parse(JSON.stringify(obj))\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("错误提示")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("VM508:5 Uncaught TypeError: Converting circular structure to JSON\n    --\x3e starting at object with constructor 'Object'\n    --- property 'year' closes the circle\n    at JSON.stringify (<anonymous>)\n    at <anonymous>:5:27\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("1.不支持Date，会变成 ISO8601 格式的字符串\n2.不支持正则表达式\n3.不支持Symbol\n4.如何支持这些复杂需求，就需要用到递归克隆了。")]),s._v(" "),a("h2",{attrs:{id:"_2-复杂需求核心有三点："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-复杂需求核心有三点："}},[s._v("#")]),s._v(" 2 复杂需求核心有三点：")]),s._v(" "),a("p",[s._v("1.递归\n2.对象分类型讨论\n3.解决循环引用（环）\n4.下面给出我的模板：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var deepCopy = function(obj) {\n    if (obj && (typeof obj !== 'object')) return false\n    var newObj = (Object.prototype.toString.call(obj) === '[object Array]') ? [] : {}\n    for (var key in obj) {\n        // hasOwnProperty 确定一个对象是否具有指定的自己的属性\n        if (obj.hasOwnProperty(key)) {\n            newObj[key] = (typeof obj[key] !== 'object' && obj[key] !== null) ? deepCopy(obj[key]) : obj[key]\n        }\n    }\n    return newObj;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"_2-不完美的方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-不完美的方案"}},[s._v("#")]),s._v(" 2 不完美的方案")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class DeepClone {\n    constructor() {\n        this.cacheList = [];\n    }\n    clone(source) {\n        if (source instanceof Object) {\n            const cache = this.findCache(source);\n            if (cache) {\n                // 如果找到缓存，直接返回\n                return cache; \n            }else {\n                let target;\n                if (source instanceof Array) {\n                    target = new Array();\n                } else if (source instanceof Function) {\n                    target =function(){\n                        return source.apply(this,arguments);\n                    };\n                } else if (source instanceof Date) {\n                    target = new Date(source);\n                } else if (source instanceof RegExp) {\n                    target = new RegExp(source.source, source.flags);\n                }\n                // 把源对象和新对象放进缓存列表\n                    this.cacheList.push([source, target]); \n                for (let key in source) {\n                    // 不拷贝原型上的属性，太浪费内存\n                    if (source.hasOwnProperty(key)) { \n                        // 递归克隆\n                        target[key] = this.clone(source[key]); \n                    }\n                }\n                return target;\n            }\n        }\n        return source;\n    }\n\n    findCache(source) {\n        for (let i = 0; i < this.cacheList.length; ++i) {\n            if (this.cacheList[i][0] === source) {\n                // 如果有环，返回对应的新对象\n                return this.cacheList[i][1];\n            }\n        }\n        return undefined;\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",[s._v("这个方案还有一些问题，离完美不小的距离：")]),s._v(" "),a("p",[s._v("1.对象类型支持不够多（Buffer，Map，Set等都不支持）\n2.存在递归爆栈的风险\n3.怎么解决？用别人封装好的第三方库。。。\n4.补充一句，如果您想看详细的测试与运行结果\n5.循环引用的问题  var = {}; a.a =a;\n6.递归爆栈的问题")])]),s._v(" "),a("h2",{attrs:{id:"_3-广度优先解决爆栈"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-广度优先解决爆栈"}},[s._v("#")]),s._v(" 3 广度优先解决爆栈")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("function cloneDeep(params) {\n    if(!isObject(params)) return data;\n    let root = {};\n    const result = [\n        {parent: root, key: undefined, data: params}\n    ];\n\n    while(result.length) {\n        // 广度优先\n        const targetObj = result.pop();\n        let parent = targetObj.parent;\n        let k = targetObj.key;\n        let obj = targetObj.data;\n\n         // 初始化赋值目标，key为undefined则拷贝到父元素，否则拷贝到子元素\n        let res = parent;\n        if (typeof k !== 'undefined') {\n            res = parent[key] = {};\n        }\n\n        for(let key in obj) {\n            if(obj.hasOwenProperty(k)) {\n                if(isObject(obj)) {\n                    result.push({\n                        parent: res,\n                        key,\n                        data: obj[key]\n                    })\n                }else {\n                    root[key] = data[key]\n                }\n            }\n        }\n    }\n    return root;\n}\nfunction isObject(obj) {\n    return instanceOf obj === 'object' && obj != null;\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);